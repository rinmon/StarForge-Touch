# **StarForge Touch: 仕様書**

## **1. ゲーム概要**

- **タイトル**: StarForge Touch
- **ジャンル**: 戦略パズル（長考型）
- **プラットフォーム**: Webアプリ（iPhone Safari、Mac Safari、PC Chrome、HTML5/JS、Yourware.soホスティング想定）
- **ターゲット**: 論理的思考を好むパズルゲーマー（10代～50代、将棋・チェス愛好者、数独・ロジックパズルファン）
- **目的**: 限られた手数内でクリスタルをポータルに配置し、論理的計画でクリア
- **コアコンセプト**: タップ操作による戦略的思考と試行錯誤で、深い達成感を提供。グリッド拡張、ギミック、ユーザーデータのサーバー管理（JSONファイル）で発展性と永続性を確保
- **開発方針**: 3x3グリッドから7x7への段階的拡張、手数制限による戦略性、ギミック組み合わせ、進行システム、サーバーデータ管理で論理的思考を重視したゲームプレイを実現

### **1.1 プロジェクト情報**

- **GitHubリポジトリ**: https://github.com/rinmon/StarForge-Touch.git
- **プロジェクト名**: StarForge-Touch
- **開発者**: rinmon
- **プロジェクトページ**: https://github.com/rinmon/StarForge-Touch
- **Issues**: https://github.com/rinmon/StarForge-Touch/issues
- **Pull Requests**: https://github.com/rinmon/StarForge-Touch/pulls
- **本番環境URL**: https://apl.chotto.news/games/StarForge-Touch/
- **ライセンス**: MIT License（推奨）
- **開発開始**: 2025年5月
- **主な開発環境**: WindSurf Editor

------

## **2. コアゲームプレイ**

### **2.1 基本ルール**

- **グリッド**: 初期は3x3グリッド（9マス）。オーブ（プレイヤー）、クリスタル（収集対象）、ポータル（ゴール）が配置

- 操作

  :

  - **タップ**: マスをタップしてオーブを1手で移動、クリスタル上でタップして「収集」、ポータル上でタップして「配置」
  - **長押し**: マスを500ms長押しでマス情報表示（ギミックの状態など）
  - **移動**: オーブは空マス経由で最短経路を自動計算（A*アルゴリズム）

- **目的**: 限られた手数内（例：3x3で6～10手）でステージ内の全クリスタルをポータルに配置

- 制限

  :

  - 各ステージに最大手数制限（3x3: 6～10手、5x5: 12～20手、7x7: 20～30手）
  - オーブは一度に1つのクリスタルしか持てない
  - 手数超過でリセット（クリスタルは保持）
  - 動く壁などのギミックはターン終了時に動作（予測可能）

- **クリア条件**: 手数内で全クリスタルをポータルに配置。最小手数でクリアすると追加スターダスト獲得

### **2.2 グリッド拡張と戦略性**

| **グリッドサイズ** | **手数目標** | **クリスタル数** | **ギミック例**               | **戦略性**   |
| ------------------ | ------------ | ---------------- | ---------------------------- | ------------ |
| **3x3（初期）**    | 6～10手      | 2～3個           | 動く壁、スイッチ             | 基本操作習得 |
| **5x5（中盤）**    | 12～20手     | 4～6個           | テレポート、霧、鍵と扉       | 経路計画     |
| **7x7（後半）**    | 20～30手     | 6～8個           | ブラックホール、複数スイッチ | 複雑な論理   |

------

## **3. ギミック・ステージシステム**

### **3.1 ギミック詳細**

- **動く壁**: ターン終了時に予測可能な方向に1マス移動。通過不可
- **スイッチ**: タップで壁の位置を変更。複数スイッチで順序性要求
- **テレポート**: 使用後1ターン待機。ペアで出現（A→B）
- **鍵と扉**: 鍵を収集して扉を開く。複数鍵で開封順序を計画
- **霧**: 視界制限（次の2マス先のみ表示）。不確実性を増加
- **ブラックホール**: オーブ/クリスタルを吸い込み、指定マスに吐出

### **3.2 ステージタイプ**

- **標準ステージ**: 手数内でクリスタル収集・配置
- **パズルモード**: 特定條件付きクリア（例：スイッチを2回まで使用）
- **ボスステージ**: 10ステージごとに登場。複雑ギミック・多クリスタル
- **デイリーチャレンジ**: 毎日1つの高難度ステージ（報酬：スターダスト200）

------

## **4. ユーザーデータ管理**

### **4.1 データ管理方針**

- **保存場所**: サーバー（Amazon LightsailのNode.js環境想定）にJSONファイル保存
- **データ形式**: ファイルベース（`/users/{user_id}.json`）
- **同期**: ゲーム起動時読み込み、ステージクリア時更新、オフライン時LocalStorage活用
- **セキュリティ**: ユーザーID認証トークン、チェックサム検証、サーバー側アクセス制御

### **4.2 JSONデータ構造**

```json
{
  "user_id": "f794e471-0611-4fa5-9c09-d83f875a281e",
  "level": 15,
  "stardust": 2500,
  "skins": ["flame", "plasma"],
  "highscores": [
    {
      "stage_id": "3x3_001",
      "min_moves": 5,
      "best_time": 18.5,
      "stardust": 150
    }
  ],
  "achievements": [
    {
      "id": "optimal_master",
      "completed": true,
      "progress": 1,
      "total": 1
    }
  ],
  "settings": {
    "sound_volume": 0.8,
    "orb_color": "plasma",
    "grid_numbers": true
  },
  "stats": {
    "total_moves": 1250,
    "puzzle_attempts": 45,
    "avg_moves_per_stage": 8.3
  },
  "last_sync": "2025-05-13T18:39:00Z"
}
```

------

## **5. プレイヤー進行システム**

### **5.1 レベルシステム**

- **レベル1～100**: ステージクリアでXP獲得

- 解放要素

  :

  - レベル5: スイッチギミック
  - レベル10: 5x5グリッド、鍵と扉
  - レベル20: テレポート、霧
  - レベル30: 7x7グリッド
  - レベル50: ブラックホール、複数スイッチ

### **5.2 スターダスト報酬**

- 獲得方法

  :

  - ステージクリア: 100スターダスト
  - 最適手数達成: +50スターダスト
  - アチーブメント: +200～500スターダスト

- 使用用途

  :

  - オーブスキン（炎、雷、プラズマ）: 1000スターダスト
  - 背景テーマ（銀河、星雲）: 2000スターダスト
  - ヒント機能: 50スターダスト/回（次の最適な1手表示）
  - 取り消し機能: 無料1回/ステージ、追加100スターダスト/回

### **5.3 アチーブメント**

- 戦略系

  :

  - 「最適解マスター」: 3x3ステージを最適手数でクリア
  - 「霧の戦略家」: 霧ステージ10回クリア
  - 「パズル王」: 7x7ボスを制限手数の80%以内でクリア

- スキル系

  :

  - 「効率化名人」: 10ステージ連続で制限手数の90%以内でクリア
  - 「計画者」: 1度も失敗せずに5ステージクリア

------

## **6. iPhone Safari最適化**

### **6.1 タッチ操作**

- **タップ応答**: 200ms以内でマス選択・アクション実行

- フィードバック

  :

  - オーブ移動: 光の軌跡アニメーション（0.3秒）
  - クリスタル収集: 粒子エフェクト＋「チリン」音
  - 失敗: 画面振動（CSS shake）＋音

- UI表示

  :

  - 手数カウンター: 画面中央上部に「5/10」形式
  - グリッド番号: オプションでチェス風（A1～C3）表示
  - ヒントボタン: 右下に配置

### **6.2 パフォーマンス**

- **描画最適化**: ターン制でフレーム更新、60fps維持
- **メモリ効率**: 40MB以内、リソース管理最適化
- **レスポンス**: 初回ロード2秒、手数確定100ms

### **6.3 視覚・聴覚デザイン**

- ビジュアル

  :

  - グリッド: チェス盤風（薄いグレー番号表示）
  - オーブ: 光る球（グリッド20%サイズ、スキンで変更）
  - クリスタル: 静的輝き（CPU負荷軽減）
  - ポータル: ゆっくり回転（0.2rad/s）

- サウンド

  :

  - 移動音: 600Hzクリック（0.1秒）
  - 成功音: 800Hz（0.2秒）
  - 失敗音: 300Hzブザー（0.2秒）
  - BGM: 60bpmアンビエント（思考阻害なし）

------

## **7. サーバー・技術仕様**

### **7.1 APIエンドポイント**

- `GET /users/{user_id}`: ユーザーデータ取得
- `POST /users/{user_id}`: データ更新
- `GET /ranking/{stage_id}`: ステージ別ランキング
- `GET /stages/{stage_id}/min_moves`: 最適手数参照
- `POST /stages/user-created`: ユーザー生成ステージ投稿

### **7.2 アルゴリズム**

- **パスファインディング**: A*で移動経路計算
- **ステージ検証**: BFSでクリア可能性・最適解確認
- **ランダム生成**: レベル適応パラメータでバランス調整

### **7.3 データバックアップ**

- 毎日深夜にJSONファイルをZIP圧縮保存
- 保存先: `/backup/YYYY-MM-DD.zip`
- 復旧手順: 破損時はバックアップから復元

------

## **8. ソーシャル・拡張機能**

### **8.1 ランキング**

- **最小手数ランキング**: ステージごとの手数競争
- **総合ランキング**: 全ステージの平均効率
- **フレンドランキング**: SNS連携でフレンド比較

### **8.2 ユーザー生成コンテンツ**

- **エディター**: グリッド配置、ギミック設定、手数制限設定
- **検証システム**: クリア可能性を自動確認
- **共有**: JSONでサーバー保存、URL共有
- **評価**: いいね数、クリア率でソート

### **8.3 シーズンイベント**

- **3ヶ月サイクル**: テーマ付き特別ギミック・ステージ
- **例**: 「時空の門シーズン」（時限テレポート）
- **報酬**: 限定スキン、背景、タイトル

------

## **9. 発展性とリプレイ性**

### **9.1 無限性の確保**

- **ランダムステージ**: レベル適応パラメータで生成
- **パズルモード**: 毎日の高難度チャレンジ
- **ユーザー生成**: 無制限のステージ投稿・プレイ

### **9.2 エンゲージメント**

- **短期（1日）**: ステージクリア達成感、手数効率化
- **中期（1週間）**: デイリーチャレンジ、アチーブメント
- **長期（1ヶ月）**: ランキング上位、全ステージ最適解

------

## **10. リスクと対策**

| **リスク**     | **影響**       | **対策**                 |
| -------------- | -------------- | ------------------------ |
| 難易度過多     | ユーザー離脱   | ヒント機能、段階的導入   |
| テンポ遅延     | 退屈感         | 視覚フィードバック強化   |
| 操作ミス       | ストレス       | 取り消し機能（1回無料）  |
| サーバー過負荷 | データ同期失敗 | バックアップ、キャッシュ |

------

## **11. プロジェクト構成・開発フロー**

### **11.1 バージョン管理戦略**

- **バージョン番号**: セマンティックバージョニング（vMAJOR.MINOR.PATCH）

- 細かい修正管理

  :

  - 機能追加: v0.1.0 → v0.2.0
  - バグ修正: v0.1.0 → v0.1.1
  - 軽微な変更: v0.1.1 → v0.1.2

- ブランチ戦略

  :

  - `main`: 本番環境
  - `develop`: 開発統合ブランチ
  - `feature/機能名`: 機能開発ブランチ
  - `hotfix/修正内容`: 緊急修正用

### **11.2 ディレクトリ構成**

```
StarForge-Touch/
├── docs/
│   ├── specifications.md      # 本仕様書
│   ├── changelog.md          # 変更履歴
│   └── api-docs.md           # API文書
├── src/                      # フロントエンド
│   ├── index.html           # メインHTML
│   ├── core/                # コアロジック
│   │   ├── game.js          # ゲーム管理
│   │   ├── grid.js          # グリッド処理
│   │   └── player.js        # プレイヤー処理
│   ├── ui/                  # UI関連
│   │   ├── touch.js         # タッチイベント
│   │   ├── visual.js        # 視覚効果
│   │   └── sound.js         # サウンド
│   └── data/                # データ管理
│       ├── storage.js       # LocalStorage
│       └── sync.js          # サーバー同期
├── server/                   # バックエンド
│   ├── app.js               # Express サーバー
│   ├── routes/              # API ルート
│   ├── data/                # JSON データ
│   │   ├── users/           # ユーザーデータ
│   │   └── ranking.json     # ランキング
│   └── tools/               # 管理ツール
├── tests/                    # テスト
│   ├── unit/                # 単体テスト
│   ├── integration/         # 統合テスト
│   └── fixtures/            # テストデータ
└── tools/                    # 開発ツール
    ├── stage-editor.html    # ステージエディター
    └── debug-console.js     # デバッグツール
```

### **11.3 開発環境設定**

- **エディター**: WindSurf（主開発環境）
- **ローカルサーバー**: `python -m http.server 8000`
- **テストサーバー**: Node.js + Express（port 3000）
- **デバッグ**: Safari Web Inspector

### **11.4 開発フェーズ**

#### Phase 1: 基盤実装 (v0.1.x)

- 3x3グリッド描画
- タッチ操作基本
- 手数制限システム
- LocalStorage

#### Phase 2: ゲームロジック (v0.2.x)

- オーブ移動・パスファインディング
- クリスタル収集・配置
- ギミック基本（動く壁）
- ステージクリア判定

#### Phase 3: 拡張機能 (v0.3.x)

- 5x5グリッド
- 追加ギミック（スイッチ、鍵）
- サーバー同期
- レベルシステム

#### Phase 4: 最適化・完成 (v1.0.x)

- 7x7グリッド
- 全ギミック実装
- ランキング・アチーブメント
- パフォーマンス最適化

### **11.5 コミット規約**

```
type(scope): subject

body

footer
```

**Type**:

- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `style`: UI/UX改善
- `test`: テスト追加
- `docs`: ドキュメント更新

**例**:

```
feat(grid): 3x3グリッド描画機能を追加

- Canvas描画でグリッド表示
- マス間隔とサイズの調整
- Safari対応確認済み

Closes #1
```

### **11.6 WindSurfでの効率的開発**

1. **プロジェクト作成時**:
   - 本仕様書をプロンプトとして活用
   - 段階的な機能実装（Phase単位）
   - 細かい修正ごとにコミット
2. **コード生成のコツ**:
   - 機能単位での実装依頼
   - HTML/CSS/JSを分離して生成
   - Safari対応を明記
3. **デバッグ支援**:
   - コンソールログ追加依頼
   - エラーハンドリングの強化
   - パフォーマンス測定コード

------

## **12. まとめ**

**StarForge Touch**は、タップ操作と手数制限により将棋・チェスのような論理的思考を要求する戦略パズルゲームです。

### **核心要素**:

1. **3x3から7x7への段階的グリッド拡張**
2. **手数制限による戦略的計画性**
3. **豊富なギミック（スイッチ、鍵、霧等）組み合わせ**
4. **JSONベースの軽量データ管理**
5. **iPhone Safari完全最適化**

### **特徴**:

- 操作が単純（タップのみ）でも戦略が深い
- 最適解探索による高いリプレイ性
- レベル・スターダスト・アチーブメントによる進行感
- ユーザー生成コンテンツで無制限の拡張性
- ランキング・シーズンイベントでコミュニティ形成

この仕様により、論理的思考を好むプレイヤーに長期的なエンゲージメントを提供し、単純な操作から深い戦略性まで段階的に楽しめるパズルゲームとして完成します。